version: '3'

vars:
  PORT: 3000
  MINTLIFY_VERSION: latest

tasks:
  # Installation
  install:
    desc: "Install Mintlify CLI globally"
    cmds:
      - npm install -g mintlify@{{.MINTLIFY_VERSION}}
    status:
      - command -v mintlify

  # Development server
  preview:
    desc: "Start Mintlify development server (uses production API)"
    cmds:
      - mintlify dev
    deps:
      - install

  dev:local:
    desc: "Start Mintlify with local API (requires API running on :8000)"
    cmds:
      - cp mint.json mint.json.backup
      - cp mint.dev.json mint.json
      - mintlify dev
      - mv mint.json.backup mint.json
    deps:
      - install

  build:
    desc: "Build documentation for production"
    cmds:
      - mintlify build
    deps:
      - install

  check:
    desc: "Check documentation for broken links and errors"
    cmds:
      - mintlify broken-links
    deps:
      - install

  # OpenAPI generation (only needed for offline development)
  openapi:
    desc: "Generate local OpenAPI spec for offline development"
    dir: ../api
    cmds:
      - .venv/bin/python generate_openapi.py
      - cp openapi.json ../docs/openapi-local.json
      - cp openapi.yaml ../docs/openapi-local.yaml
      - echo "✓ Local OpenAPI specification generated"
      - echo "ℹ️  Note: Production uses dynamic URL (https://api.mecapy.com/openapi.json)"

  # Cleanup
  clean:
    desc: "Clean build artifacts and cache"
    cmds:
      - rm -rf .mintlify
      - rm -rf node_modules
      - rm -f package-lock.json
      - echo "✅ Cleaned build artifacts"

  # Default task
  default:
    desc: "Show available tasks"
    cmds:
      - task --list
